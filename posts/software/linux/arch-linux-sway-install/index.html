<!doctype html><html><head><title>Arch Linux Sway Install Guide</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><link rel=icon type=image/png href=/images/site/logo_huccbe1dced2bd58e862e6c832fc83ef57_9458_42x0_resize_q75_h2_box_2.webp><meta property="og:title" content="Arch Linux Sway Install Guide"><meta property="og:description" content="Easy Install Guide For Arch Linux"><meta property="og:type" content="article"><meta property="og:url" content="https://portfolio.kylerassweiler.ca/posts/software/linux/arch-linux-sway-install/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-23T10:58:08-04:00"><meta property="article:modified_time" content="2022-03-23T10:58:08-04:00"><meta name=description content="Easy Install Guide For Arch Linux"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/logo_huccbe1dced2bd58e862e6c832fc83ef57_9458_42x0_resize_q75_h2_box_2.webp alt=Logo>
Kyle Rassweiler's Portfolio</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=dark></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20></a></div></li></ul></div></div><img src=/images/site/logo_huccbe1dced2bd58e862e6c832fc83ef57_9458_42x0_resize_q75_h2_box_2.webp class=d-none id=main-logo alt=Logo>
<img src=/images/site/logo-inverted_hu070bfe41fdeb7aa0d8e46d50934d5f6a_10868_42x0_resize_q75_h2_box_2.webp class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/design/>Design</a><ul><li><a href=/posts/design/2d/ title=2D>2D</a></li><li><a href=/posts/design/3d/ title=3D>3D</a></li><li><a href=/posts/design/cad/ title=CAD>CAD</a></li><li><a href=/posts/design/game-dev/ title="Game Dev">Game Dev</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/farming/>Farming</a><ul><li><a href=/posts/farming/recipes/ title=Recipes>Recipes</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/posts/hardware/>Hardware</a><ul><li><a href=/posts/hardware/homelab/ title=Homelab>Homelab</a></li><li><a href=/posts/software/web/ title=Web>Web</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/software/>Software</a><ul class=active><li><a href=/posts/software/c++/ title=C++>C++</a></li><li><a class=active href=/posts/software/linux/ title=Linux>Linux</a></li><li><a href=/posts/software/node/ title=Node>Node</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/software/linux/arch-linux-sway-install/images/archsway-bg.webp)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/site/profile_hu89e528c40daf077150afc70038779b42_25184_120x120_fit_q75_h2_box_2.webp alt="Author Image"><h5 class=author-name></h5><p>Wednesday, March 23, 2022</p></div><div class=title><h1>Arch Linux Sway Install Guide</h1></div><div class=taxonomy-terms><ul><li class=rounded><a href=/tags/os class="btn, btn-sm">OS</a></li><li class=rounded><a href=/tags/arch class="btn, btn-sm">Arch</a></li><li class=rounded><a href=/tags/linux class="btn, btn-sm">Linux</a></li><li class=rounded><a href=/tags/btrfs class="btn, btn-sm">BTRFS</a></li><li class=rounded><a href=/tags/snapper class="btn, btn-sm">Snapper</a></li><li class=rounded><a href=/tags/sway class="btn, btn-sm">Sway</a></li><li class=rounded><a href=/tags/wayland class="btn, btn-sm">Wayland</a></li></ul></div><div class=post-content id=post-content><p><em>Updated: 2022-04-22</em></p><p>This guide is for installing arch linux (UEFI) with Wayland, Swaywm, Ly desktop launcher, Paru, BTRFS, Subvolumes, Snapper, Snap-pac-grub, Snapshots, Qemu, KVM, Iommu, and Gaming.</p><hr><h2 id=install-iso-to-usb>Install ISO to USB:</h2><p>After downloading the latest <a href=https://archlinux.org/download/>Arch ISO</a> you will need to install it to a usb using a program like <a href=https://github.com/balena-io/etcher>Balena Etcher</a>. Plug the usb into the machine you want to install arch to and boot into the usb.</p><hr><h2 id=vm-setup>VM Setup</h2><figure><a href=images/arch-sway-01.webp><img src=images/arch-sway-01.webp></a><figcaption><h4>Qemu display settings</h4></figcaption></figure><figure><a href=images/arch-sway-02.webp><img src=images/arch-sway-02.webp></a><figcaption><h4>Qemu video settings</h4></figcaption></figure><hr><h2 id=base-install>Base Install</h2><h3 id=give-root-a-password-then-get-the-local-ip>Give root a password then get the local ip:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>passwd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ip address show
</span></span></code></pre></div><h3 id=ssh-into-the-target-machine-from-your-main>SSH into the target machine from your main:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>ssh root@xxx.xxx.xxx.xxx
</span></span></code></pre></div><h3 id=find-your-device>Find your device:</h3><p>Use lsblk to dyplay your disk information, normally the drive will listed as SDA or SDB.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>lsblk
</span></span></code></pre></div><h3 id=wipe-existing-btrfs-systems>Wipe Existing BTRFS Systems:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>gdisk /dev/XXX
</span></span></code></pre></div><h3 id=edit-filesystem>Edit Filesystem:</h3><p>Replace XXX with the target device. Gdisk is for GPT partitions and UEFI, use Fdisk for mbr partitions and bios boot.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>gdisk /dev/XXX
</span></span></code></pre></div><h3 id=create-boot-partition>Create Boot Partition:</h3><p>Use the n command to create a new partition on the disk, use the default partition number, use the default first sector, offset the last sector by 512M, and give it a efi flag of ef00.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>n
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+512M
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ef00
</span></span></code></pre></div><h3 id=create-swap-partition-optional><del>Create Swap Partition (Optional)</del>:</h3><p>We will instead use zramd from the aur or zram-generator from the main repo at a later point</p><h3 id=create-main-partition-and-write-changes>Create Main Partition And Write Changes:</h3><p>Use the n command to create a new partition on the disk, use the default partition number, use the default first sector, since we are using the remainder of the disk we can use the default last sector, and use the default flag for linux filesystem.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>n
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-1G <span style=color:#f92672>(</span>leave space at end <span style=color:#66d9ef>for</span> ssd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>w
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>y
</span></span></code></pre></div><h3 id=setup-partition-filesystems-and-subvolumes>Setup Partition Filesystems And Subvolumes:</h3><p>If you skipped the swap partition then skip the mkswap and swapon and use the right partition number for the btrfs volume.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mkfs.vfat /dev/vda1 <span style=color:#75715e>#Can also use mkfs.fat -F32 /dev/xxxx</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkfs.btrfs /dev/vda2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount /dev/vda2 /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btrfs su cr @
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btrfs su cr @home
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btrfs su cr @snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>btrfs su cr @var_log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd ..
</span></span></code></pre></div><h4 id=btrfs-raids-side-note-todo-investigate>BTRFS Raids Side Note (TODO: INVESTIGATE):</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mkfs.btrfs -m raid1 -d raid1 /dev/vdaX /dev/vdaY
</span></span></code></pre></div><h3 id=remount-partitions-individually>Remount Partitions Individually:</h3><p>In order to setup the systems fstab we need to remount the partitions individually with the proper settings.</p><p>Use lsblk to verify all partitions and volumes were mounted.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>umount /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount -o noatime,compress<span style=color:#f92672>=</span>zstd,space_cache<span style=color:#f92672>=</span>v2,discard<span style=color:#f92672>=</span>async,subvol<span style=color:#f92672>=</span>@ /dev/vda2 /mnt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p /mnt/<span style=color:#f92672>{</span>boot,home,.snapshots,var/log<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount -o noatime,compress<span style=color:#f92672>=</span>zstd,space_cache<span style=color:#f92672>=</span>v2,discard<span style=color:#f92672>=</span>async,subvol<span style=color:#f92672>=</span>@home /dev/vda2 /mnt/home
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount -o noatime,compress<span style=color:#f92672>=</span>zstd,space_cache<span style=color:#f92672>=</span>v2,discard<span style=color:#f92672>=</span>async,subvol<span style=color:#f92672>=</span>@snapshots /dev/vda2 /mnt/.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount -o noatime,compress<span style=color:#f92672>=</span>zstd,space_cache<span style=color:#f92672>=</span>v2,discard<span style=color:#f92672>=</span>async,subvol<span style=color:#f92672>=</span>@var_log /dev/vda2 /mnt/var/log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mount /dev/vda1 /mnt/boot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lsblk
</span></span></code></pre></div><h3 id=add-desired-packages-may-have-error-about-missing-file-fsckbtrfs>Add desired packages (May have error about missing file fsck.btrfs):</h3><p>Choose your base: <code>linux, linux-lts, linux-zen</code>.</p><p>Choose your ucode: <code>intel-ucode, amd-ucode</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacstrap /mnt base linux-zen linux-zen-headers linux-firmware intel-ucode amd-ucode btrfs-progs nano reflector git rsync sudo
</span></span></code></pre></div><h3 id=generate-fstab>Generate fstab:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>genfstab -U /mnt &gt;&gt; /mnt/etc/fstab
</span></span></code></pre></div><h3 id=enter-system>Enter system:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>arch-chroot /mnt
</span></span></code></pre></div><h3 id=setup-system-time>Setup System Time:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>timedatectl list-timezones | grep Toronto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ln -sf /usr/share/zoneinfo/America/Toronto /etc/localtime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hwclock --systohc
</span></span></code></pre></div><h3 id=update-the-timezone>Update the timezone:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>timedatectl set-ntp true
</span></span></code></pre></div><h3 id=setup-locale-generator>Setup Locale Generator:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/locale.gen
</span></span></code></pre></div><p>Uncomment your desired locales</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>en_CA.UTF-8</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>en_US.UTF-8</span>
</span></span></code></pre></div><h3 id=generate-locale>Generate Locale:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>locale-gen
</span></span></code></pre></div><h3 id=update-keymap>Update Keymap:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/vconsole.conf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>KEYMAP=us</span>
</span></span></code></pre></div><h3 id=update-mirrors>Update Mirrors:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span><span style=color:#75715e>#reflector -c Canada -c US -a 6 --sort rate --save /etc/pacman.d/mirrorlist</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reflector --country Canada,USA --age <span style=color:#ae81ff>12</span> --protocol https --sort rate --save /etc/pacman.d/mirrorlist
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pacman -Syy
</span></span></code></pre></div><h3 id=create-locale-config>Create Locale Config:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/locale.conf
</span></span></code></pre></div><p>Insert you chosen language from step 16</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>LANG=en_US.UTF-8</span>
</span></span></code></pre></div><h3 id=create-hostname-file>Create Hostname File:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/hostname
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>NAME</span>
</span></span></code></pre></div><h3 id=setup-hosts>Setup Hosts:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/hosts
</span></span></code></pre></div><p>Add the following entries replacing NAME with your hostname</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>127.0.0.1</span>       <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span>::<span style=color:#ae81ff>1</span>             <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>127.0.1.1</span>       <span style=color:#ae81ff>NAME.localdomain NAME</span>
</span></span></code></pre></div><h3 id=set-root-password-for-actual-system>Set Root Password For Actual System:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>passwd
</span></span></code></pre></div><h3 id=enable-multilib>Enable Multilib:</h3><p>This will allow us to install steam, wine, and lutris</p><p>Edit the pacman configuration</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/pacman.conf
</span></span></code></pre></div><p>uncomment Multilib and the include</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>[<span style=color:#ae81ff>multilib]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Include = /etc/pacman.d/mirrorlist</span>
</span></span></code></pre></div><p>update system:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -Syu
</span></span></code></pre></div><h3 id=create-user>Create User:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>useradd -mG wheel NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>passwd NAME
</span></span></code></pre></div><h3 id=allow-wheel-as-root>Allow Wheel As Root:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>EDITOR<span style=color:#f92672>=</span>nano visudo
</span></span></code></pre></div><p>Uncomment the following</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>%wheel ALL=(ALL:ALL) ALL</span>
</span></span></code></pre></div><h3 id=install-packages>Install Packages:</h3><p><code>avahi</code> is for dns service discovery</p><p><code>gvfs</code> is gnome virtual filesystem</p><p><code>xdg</code> helps apps integrade with the desktop</p><p><code>cups</code> is printer support</p><p><code>mtools</code> provides dos file support</p><p><code>acpi</code> provides power support</p><p><code>ipset</code> maintain set of ips for firewall</p><p><code>fish</code> is an alternative to bash</p><p><code>ntfs-3g</code> is an open source MS NTFS implementation</p><p><code>iptables-nft</code> is a modern version of iptables, ok to replace</p><p><strong>WARNING</strong> xdg-desktop-portal will request a repo for xdg-desktop-portal-impl, choose the wlr version.</p><p><strong>WARNING</strong> choose Y to remove iptables</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S xdg-desktop-portal base-devel grub grub-btrfs efibootmgr networkmanager network-manager-applet dialog avahi gvfs gvfs-smb nfs-utils cifs-utils ntfs-3g inetutils dnsutils mtools dosfstools snapper snap-pac xdg-utils xdg-user-dirs alsa-utils usbutils openssh grub-customizer os-prober cups acpi acpi_call acpid iptables-nft ipset firewalld nss-mdns bash-completion fish archlinux-keyring wofi hwinfo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl enable NetworkManager
</span></span><span style=display:flex><span>systemctl enable cups.service
</span></span><span style=display:flex><span>systemctl enable sshd
</span></span><span style=display:flex><span>systemctl enable avahi-daemon
</span></span><span style=display:flex><span>systemctl enable reflector.timer
</span></span><span style=display:flex><span>systemctl enable fstrim.timer
</span></span><span style=display:flex><span>systemctl enable firewalld
</span></span><span style=display:flex><span>systemctl enable acpid
</span></span></code></pre></div><h4 id=audio>Audio:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S sof-firmware pipewire pipewire-jack pipewire-alsa pipewire-pulse pipewire-media-session pavucontrol
</span></span></code></pre></div><h4 id=laptop-extras>Laptop extras:</h4><p><code>tlp</code> is for battery power saving</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S wpa_supplicant tlp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl enable tlp
</span></span></code></pre></div><h4 id=bluetooth-extras>Bluetooth extras:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S bluez bluez-utils
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl enable bluetooth
</span></span></code></pre></div><h4 id=vm>VM:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S virt-manager qemu qemu-arch-extra vde2 bridge-utils dnsmasq openbsd-netcat
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl enable libvirtd
</span></span><span style=display:flex><span>systemctl enable virtlogd.socket
</span></span></code></pre></div><h4 id=graphics>Graphics:</h4><p>Nouveu:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S mesa lib32-mesa
</span></span></code></pre></div><p><del>Nvidia</del> (<strong>Unsupported on sway</strong>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S nvidia nvidia-utils nvidia-settings nvidia-dkms
</span></span></code></pre></div><p>AMD:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>pacman -S mesa lib32-mesa vulkan-radeon
</span></span></code></pre></div><h3 id=setup-cpio-modules-and-hooks>Setup CPIO Modules And Hooks:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/mkinitcpio.conf
</span></span></code></pre></div><p>Insert <code>btrfs</code> and other items into the brackets for modules.</p><ul><li><p>Virtualization: <code>vfio_pci vfio vfio_iommu_type1 vfio_virqfd</code></p></li><li><p>Nouveau: <code>nouveau</code></p></li><li><p>Amd: <code>amdgpu</code></p></li><li><p>Nvidia: <code>nvidia</code></p></li></ul><p>Ensure modconf is in hooks and uncomment zstd compression</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># MODULES</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The following modules are loaded before any boot hooks are</span>
</span></span><span style=display:flex><span><span style=color:#75715e># run.  Advanced users may wish to specify all system modules</span>
</span></span><span style=display:flex><span><span style=color:#75715e># in this array.  For instance:</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>MODULES=(vfio_pci vfio vfio_iommu_type1 vfio_virqfd btrfs nvidia)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##   This setup specifies all modules in the MODULES setting above.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##   No raid, lvm2, or encrypted root is needed.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#    HOOKS=(base)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##   This setup will autodetect all modules for your system and should</span>
</span></span><span style=display:flex><span><span style=color:#75715e>##   work as a sane default</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#    HOOKS=(base udev autodetect block filesystems)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>HOOKS=(base udev autodetect modconf block filesystems keyboard fsck)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># COMPRESSION</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Use this to compress the initramfs image. By default, gzip compression</span>
</span></span><span style=display:flex><span><span style=color:#75715e># is used. Use &#39;cat&#39; to create an uncompressed image.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>COMPRESSION=&#34;zstd&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;gzip&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;bzip2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;lzma&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;xz&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;lzop&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#COMPRESSION=&#34;lz4&#34;</span>
</span></span></code></pre></div><p>run mkinit for the chosen kernel (<code>linux</code>, <code>linux-lts</code>, <code>linux-zen</code>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>mkinitcpio -p linux-zen
</span></span></code></pre></div><h3 id=istall-grub>Istall Grub:</h3><p>Grub is the system that will locate and boot any os on your drive.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>grub-install --target<span style=color:#f92672>=</span>x86_64-efi --efi-directory<span style=color:#f92672>=</span>/boot --bootloader-id<span style=color:#f92672>=</span>GRUB
</span></span></code></pre></div><p>Open grub config</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>nano /etc/default/grub
</span></span></code></pre></div><p>Add iommu for system into <code>GRUB_CMDLINE_LINUX_DEFAULT</code> section.</p><p>Amd: <code>amd_iommu=on</code> This doesn&rsquo;t seem to be required on newer hardware&mldr;</p><p>Intel: <code>intel_iommu=on</code></p><p>Passthrough: <code>iommu=pt</code></p><p>VM: <code>video=1920x1080</code> Or the desired resolution</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet intel_iommu=on iommu=pt loglevel=3 nowatchdog&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>GRUB_CMDLINE_LINUX=&#34;&#34;</span>
</span></span></code></pre></div><p>Update grub</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></div><h3 id=finish-setup-and-reboot>Finish Setup And Reboot:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>exit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>umount -a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><hr><h2 id=desktop-and-usability>Desktop and Usability</h2><h3 id=ssh-into-machine-as-new-user>SSH Into Machine As New User:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>ssh NAME@xxx.xxx.xxx.xxx
</span></span></code></pre></div><h3 id=access-aur-with-paru>Access AUR with Paru:</h3><p>The arch user repository has some handy GUI packages for interacting with snapshots.</p><p>There are a few options for accessing the aur (<strong>I prefer paru</strong>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>cd /tmp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git clone https://aur.archlinux.org/paru.git
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd paru
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>makepkg -si
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd ~
</span></span></code></pre></div><h3 id=setup-fonts-and-icons>Setup fonts and icons:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>paru -S nerd-fonts-complete
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo pacman -S arc-icon-theme
</span></span></code></pre></div><h3 id=setup-zram>Setup zram:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>paru -S zramd
</span></span></code></pre></div><p>Edit the config for your setup</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo nano /etc/default/zramd
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Max total swap size in MB</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>MAX_SIZE=8192</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Number of zram devices to create</span>
</span></span><span style=display:flex><span> <span style=color:#ae81ff>NUM_DEVICES=1</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo systemctl enable --now zramd.service
</span></span></code></pre></div><h3 id=fix-snapshots>Fix Snapshots:</h3><p>This step allows the non root user to manage all the snapshots</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo umount /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo rm -r /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo snapper -c root create-config /
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo btrfs su del /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo mkdir /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo mount -a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chmod <span style=color:#ae81ff>750</span> /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chmod a+rx /.snapshots
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo chown :NAME /.snapshots
</span></span></code></pre></div><h3 id=setup-snapper>Setup Snapper:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo nano /etc/snapper/configs/root
</span></span></code></pre></div><p>Make the following changes based on preference, and make sure to add the new user to the allowed list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>ALLOW_USERS=&#34;NAME&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TIMELINE_LIMIT_HOURLY=&#34;5&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TIMELINE_LIMIT_DAILY=&#34;7&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TIMELINE_LIMIT_WEEKLY=&#34;0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TIMELINE_LIMIT_MONTHLY=&#34;0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>TIMELINE_LIMIT_YEARLY=&#34;0&#34;</span>
</span></span></code></pre></div><p>Snapper is what creates the btrfs snapshots allowing us to roll back changes.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo systemctl enable --now snapper-timeline.timer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo systemctl enable --now snapper-cleanup.timer
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>paru -S snap-pac-grub snapper-gui
</span></span></code></pre></div><h3 id=setup-pacman-hooks-for-snapper>Setup Pacman Hooks For Snapper:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo mkdir /etc/pacman.d/hooks
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo nano /etc/pacman.d/hooks/50-bootbackup.hook
</span></span></code></pre></div><p>Paste in the hook information.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>[<span style=color:#ae81ff>Trigger]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Operation = Upgrade</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Operation = Install</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Operation = Remove</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Type = Path</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Target = usr/lib/modules/*/vmlinuz</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[<span style=color:#ae81ff>Action]</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Depends = rsync</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Description = Backing up /boot...</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>When = PostTransaction</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>Exec = /usr/bin/rsync -a --delete /boot /.bootbackup</span>
</span></span></code></pre></div><h3 id=install-sway--de>Install Sway + DE:</h3><p><code>obs-studio-tytan652</code> has better plugins packaged vs <code>obs</code> from main</p><p><code>wlrobs</code> wlrobs is an obs-studio plugin that allows you to screen capture on wlroots based wayland compositors</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo pacman -S sway waybar wofi xorg-xwayland thunar firefox neofetch starship code keepassxc gnome-keyring libsecret xfce4-settings lsd exa btop nextcloud-client mako swaybg lm_sensors xfce4-settings steam wine-staging lutris wine-mono discord mousepad bat gvfs-mtp tumbler thunar-volman thunar-archive-plugin thunar-media-tags-plugin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>paru -S ly-git dmenu-wayland-git wezterm jellyfin-media-player haruna proton proton-ge-custom protonup-qt betterdiscord-installer obs-studio-tytan652 mangohud gimp swayimg swaync swaylock-effects wlrobs wpaperd wlogout jmtpfs autotiling
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo systemctl enable ly.service
</span></span></code></pre></div><figure><a href=images/arch-sway-04.webp><img src=images/arch-sway-04.webp></a><figcaption><h4>swaylock-effects dracula theme</h4></figcaption></figure><h3 id=set-env-variables>Set Env Variables:</h3><p>Some of these are for improving vm experiences others for nvidia users, add them to /etc/environment</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo nano /etc/environment
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#ae81ff>__GL_GSYNC_ALLOWED=0</span> <span style=color:#75715e>#VM no gl passed through</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>__GL_VRR_ALLOWED=0</span> <span style=color:#75715e>#VM no gl passed through</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#WLR_DRM_NO_ATOMIC=1 #Unknown, causes flicker in VM</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>QT_AUTO_SCREEN_SCALE_FACTOR=1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>QT_QPA_PLATFORM=wayland</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>QT_WAYLAND_DISABLE_WINDOWDECORATION=1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>GDK_BACKEND=wayland</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#GTK_USE_PORTAL=0 #Fix GTK apps delayed open, alt use is in config for sway</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>XDG_CURRENT_DESKTOP=sway</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>GBM_BACKEND=nvidia-drm</span> <span style=color:#75715e>#If using nvidia card</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>__GLX_VENDOR_LIBRARY_NAME=nvidia</span> <span style=color:#75715e>#If using nvidia card</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>MOZ_ENABLE_WAYLAND=1</span> <span style=color:#75715e>#This is if you choose not to use xorg-xwayland</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>WLR_NO_HARDWARE_CURSORS=1</span> <span style=color:#75715e>#This is to show the cursor in my VM</span>
</span></span></code></pre></div><figure><a href=/images/arch-sway-03.webp><img src=/images/arch-sway-03.webp></a><figcaption><h4>Sway env variables</h4></figcaption></figure><h3 id=set-theme>Set Theme:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>gsettings set org.gnome.desktop.interface gtk-theme <span style=color:#e6db74>&#39;Dracula&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gsettings set org.gnome.desktop.wm.preferences theme <span style=color:#e6db74>&#39;Dracula&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gsettings set org.gnome.desktop.interface icon-theme <span style=color:#e6db74>&#39;Dracula&#39;</span>
</span></span></code></pre></div><h3 id=copy-configs-from-git-optional>COPY CONFIGS FROM GIT (Optional):</h3><p>These are my own mashed together configs, mostly from my i3wm system. There are also some backgrounds in the repo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>git clone https://github.com/rassweiler/dotfiles.git <span style=color:#f92672>&amp;&amp;</span> cd dotfiles <span style=color:#f92672>&amp;&amp;</span> ./install
</span></span></code></pre></div><p><del>Overwrite the .config and .local folders in your user directory and reboot the system.</del>(The repo now uses dotbot to symlink all configs)</p><h3 id=set-shell>Set Shell:</h3><p>the default is bash, I prefer fish&mldr; but know that some commands will need to be changed to run in fish.</p><p>Example Bash/zsh:<code>chsh -s $(which fish)</code> vs fish: <code>chsh -s (which zsh)</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>chsh -s <span style=color:#66d9ef>$(</span>which fish<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><h3 id=install-extra-audio-packages>Install Extra Audio Packages:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>paru -S carla noise-repellent calf
</span></span></code></pre></div><h3 id=update-user>Update User:</h3><p>Adding the user to the audio and video groups may not be necessary, this was done for gaming with multiple xorg servers.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo usermod -aG audio NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo usermod -aG video NAME
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo usermod -aG libvirt NAME
</span></span></code></pre></div><h3 id=gaming-extras-for-winelutris>Gaming Extras For Wine/Lutris:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo pacman -S winetricks
</span></span></code></pre></div><p>Extra wine packages</p><pre tabindex=0><code>sudo pacman -S giflib lib32-giflib libpng lib32-libpng libldap lib32-libldap gnutls lib32-gnutls mpg123 lib32-mpg123 openal lib32-openal v4l-utils lib32-v4l-utils libpulse lib32-libpulse alsa-plugins lib32-alsa-plugins alsa-lib lib32-alsa-lib libjpeg-turbo lib32-libjpeg-turbo libxcomposite lib32-libxcomposite libxinerama lib32-libxinerama ncurses lib32-ncurses opencl-icd-loader lib32-opencl-icd-loader libxslt lib32-libxslt libva lib32-libva gtk3 lib32-gtk3 gst-plugins-base-libs lib32-gst-plugins-base-libs vulkan-icd-loader lib32-vulkan-icd-loader samba dosbox
</code></pre><h3 id=generate-ssh-key-and-add-to-agent>Generate SSH Key And add To Agent:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>ssh-keygen -t ed25519 -C <span style=color:#e6db74>&#34;your_email@example.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>eval <span style=color:#f92672>(</span>ssh-agent -c<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ssh-add ~/.ssh/id_ed25519
</span></span></code></pre></div><h3 id=setup-libvirtd>Setup Libvirtd:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zsh data-lang=zsh><span style=display:flex><span>sudo nano /etc/libvirt/libvirtd.conf
</span></span></code></pre></div><p>Set group to use libvirt with 770 permissions</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Set the UNIX domain socket group ownership. This can be used to</span>
</span></span><span style=display:flex><span><span style=color:#75715e># allow a &#39;trusted&#39; set of users access to management capabilities</span>
</span></span><span style=display:flex><span><span style=color:#75715e># without becoming root.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This setting is not required or honoured if using systemd socket</span>
</span></span><span style=display:flex><span><span style=color:#75715e># activation.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This is restricted to &#39;root&#39; by default.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>unix_sock_group = &#34;libvirt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the UNIX socket permissions for the R/W socket. This is used</span>
</span></span><span style=display:flex><span><span style=color:#75715e># for full management of VMs</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># This setting is not required or honoured if using systemd socket</span>
</span></span><span style=display:flex><span><span style=color:#75715e># activation.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Default allows only root. If PolicyKit is enabled on the socket,</span>
</span></span><span style=display:flex><span><span style=color:#75715e># the default will change to allow everyone (eg, 0777)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># If not using PolicyKit and setting group ownership for access</span>
</span></span><span style=display:flex><span><span style=color:#75715e># control, then you may want to relax this too.</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>unix_sock_rw_perms = &#34;0770&#34;</span>
</span></span></code></pre></div><hr><h3 id=references>REFERENCES</h3><ul><li><a href=https://wiki.archlinux.org/title/Installation_guide>Arch Install Guide</a></li><li><a href=https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF>Arch PCI Passthrough</a></li><li><a href="https://www.youtube.com/watch?v=h7SG7ccjn-g">SomeOrdinaryGamer</a></li><li><a href="https://www.youtube.com/watch?v=o09jzArQcFQ">EF - Linux Made Simple</a></li></ul></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f" target=_blank><i class="fab fa-facebook"></i></a>
<a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f&text=Arch%20Linux%20Sway%20Install%20Guide&via=Kyle%20Rassweiler%27s%20Portfolio" target=_blank><i class="fab fa-twitter"></i></a>
<a class="btn btn-sm reddit-btn" href="https://reddit.com/submit?url=https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f&title=Arch%20Linux%20Sway%20Install%20Guide" target=_blank><i class="fab fa-reddit"></i></a>
<a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f&title=Arch%20Linux%20Sway%20Install%20Guide" target=_blank><i class="fab fa-linkedin"></i></a>
<a class="btn btn-sm whatsapp-btn" href="https://api.whatsapp.com/send?text=Arch%20Linux%20Sway%20Install%20Guide https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f" target=_blank><i class="fab fa-whatsapp"></i></a>
<a class="btn btn-sm email-btn" href="mailto:?subject=Arch%20Linux%20Sway%20Install%20Guide&body=https%3a%2f%2fportfolio.kylerassweiler.ca%2fposts%2fsoftware%2flinux%2farch-linux-sway-install%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/rassweiler/portfolio/edit/master/content/posts/Software/Linux/arch-linux-sway-install/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#install-iso-to-usb>Install ISO to USB:</a></li><li><a href=#vm-setup>VM Setup</a></li><li><a href=#base-install>Base Install</a><ul><li><a href=#give-root-a-password-then-get-the-local-ip>Give root a password then get the local ip:</a></li><li><a href=#ssh-into-the-target-machine-from-your-main>SSH into the target machine from your main:</a></li><li><a href=#find-your-device>Find your device:</a></li><li><a href=#wipe-existing-btrfs-systems>Wipe Existing BTRFS Systems:</a></li><li><a href=#edit-filesystem>Edit Filesystem:</a></li><li><a href=#create-boot-partition>Create Boot Partition:</a></li><li><a href=#create-swap-partition-optional>Create Swap Partition (Optional):</a></li><li><a href=#create-main-partition-and-write-changes>Create Main Partition And Write Changes:</a></li><li><a href=#setup-partition-filesystems-and-subvolumes>Setup Partition Filesystems And Subvolumes:</a></li><li><a href=#remount-partitions-individually>Remount Partitions Individually:</a></li><li><a href=#add-desired-packages-may-have-error-about-missing-file-fsckbtrfs>Add desired packages (May have error about missing file fsck.btrfs):</a></li><li><a href=#generate-fstab>Generate fstab:</a></li><li><a href=#enter-system>Enter system:</a></li><li><a href=#setup-system-time>Setup System Time:</a></li><li><a href=#update-the-timezone>Update the timezone:</a></li><li><a href=#setup-locale-generator>Setup Locale Generator:</a></li><li><a href=#generate-locale>Generate Locale:</a></li><li><a href=#update-keymap>Update Keymap:</a></li><li><a href=#update-mirrors>Update Mirrors:</a></li><li><a href=#create-locale-config>Create Locale Config:</a></li><li><a href=#create-hostname-file>Create Hostname File:</a></li><li><a href=#setup-hosts>Setup Hosts:</a></li><li><a href=#set-root-password-for-actual-system>Set Root Password For Actual System:</a></li><li><a href=#enable-multilib>Enable Multilib:</a></li><li><a href=#create-user>Create User:</a></li><li><a href=#allow-wheel-as-root>Allow Wheel As Root:</a></li><li><a href=#install-packages>Install Packages:</a></li><li><a href=#setup-cpio-modules-and-hooks>Setup CPIO Modules And Hooks:</a></li><li><a href=#istall-grub>Istall Grub:</a></li><li><a href=#finish-setup-and-reboot>Finish Setup And Reboot:</a></li></ul></li><li><a href=#desktop-and-usability>Desktop and Usability</a><ul><li><a href=#ssh-into-machine-as-new-user>SSH Into Machine As New User:</a></li><li><a href=#access-aur-with-paru>Access AUR with Paru:</a></li><li><a href=#setup-fonts-and-icons>Setup fonts and icons:</a></li><li><a href=#setup-zram>Setup zram:</a></li><li><a href=#fix-snapshots>Fix Snapshots:</a></li><li><a href=#setup-snapper>Setup Snapper:</a></li><li><a href=#setup-pacman-hooks-for-snapper>Setup Pacman Hooks For Snapper:</a></li><li><a href=#install-sway--de>Install Sway + DE:</a></li><li><a href=#set-env-variables>Set Env Variables:</a></li><li><a href=#set-theme>Set Theme:</a></li><li><a href=#copy-configs-from-git-optional>COPY CONFIGS FROM GIT (Optional):</a></li><li><a href=#set-shell>Set Shell:</a></li><li><a href=#install-extra-audio-packages>Install Extra Audio Packages:</a></li><li><a href=#update-user>Update User:</a></li><li><a href=#gaming-extras-for-winelutris>Gaming Extras For Wine/Lutris:</a></li><li><a href=#generate-ssh-key-and-add-to-agent>Generate SSH Key And add To Agent:</a></li><li><a href=#setup-libvirtd>Setup Libvirtd:</a></li><li><a href=#references>REFERENCES</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#projects>Featured Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#accomplishments>Accomplishments</a></li><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://portfolio.kylerassweiler.ca/#education>Education</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:jobs@kylerassweiler.ca target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>jobs@kylerassweiler.ca</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+1-613-724-9141</span></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center"> 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script></body></html>